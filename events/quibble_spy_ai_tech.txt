namespace = quibble_spy_ai_tech

country_event = { #PICK RESEARCH STEAL TYPE
	id = quibble_spy_ai_tech.1
    is_triggered_only = yes

    immediate = {

        save_event_target_as = snitch_home

        random_neighbor_country = {
			limit = {
                is_country_type = default
                has_communications = event_target:snitch_home

			}
            save_event_target_as = target_1
        }
        random_neighbor_country = {
			limit = {
				NOR = {
                    is_same_value = event_target:target1
				}
                is_country_type = default
                has_communications = event_target:snitch_home

			}
            save_event_target_as = target_2
        }
        random_neighbor_country = {
			limit = {
				NOR = {
                    is_same_value = event_target:target1
                    is_same_value = event_target:target2
				}
                is_country_type = default
                has_communications = event_target:snitch_home

			}
            save_event_target_as = target_3
        }
        random_neighbor_country = {
			limit = {
				NOR = { 
                    is_same_value = event_target:target1
                    is_same_value = event_target:target2
                    is_same_value = event_target:target3
				}
                is_country_type = default
                has_communications = event_target:snitch_home

			}
            save_event_target_as = target_4
        }
        random_neighbor_country = {
			limit = {
				NOR = {
                    is_same_value = event_target:target1
                    is_same_value = event_target:target2
                    is_same_value = event_target:target3
                    is_same_value = event_target:target4
				}
                is_country_type = default
                has_communications = event_target:snitch_home

			}
            save_event_target_as = target_5
        }
        random_neighbor_country = {
			limit = {
				NOR = {
                    
                    is_same_value = event_target:target1
                    is_same_value = event_target:target2
                    is_same_value = event_target:target3
                    is_same_value = event_target:target4
                    is_same_value = event_target:target5
				}
                is_country_type = default
                has_communications = event_target:snitch_home

			}
            save_event_target_as = target_6
        }
    }
        
    option = {
        name = quibble_spy_ai_tech.1.a
        trigger = { exists = event_target:target_1 }
        allow = { exists = event_target:target_1 }
        
        ai_chance = {
            factor = 100
            modifier = { #DISLIKE THEM MED
                factor = 2.00
                OR = {
                    tech_unlocked_ratio = {
                        who = event_target:target_1
                        ratio < 0.7
                    }
                    is_unfriendly_to = event_target:target_1
                    is_disloyal_to = event_target:target_1
                    opinion = { who = event_target:target_1 value <= -50 }
                }
            }
            modifier = { #DISLIKE THEM HIGH
                factor = 3.00
                OR = {
                    tech_unlocked_ratio = {
                        who = event_target:target_1
                        ratio < 0.5
                    }
                    is_hostile_to = event_target:target_1
                    is_angry_to = event_target:target_1
                    is_rival = event_target:target_1
                    opinion = { who = event_target:target_1 value <= -100 }
                }
            }
        
            modifier = { #ANTI INTELLIGENCE SCARED OFF
                factor = -0.50
                OR = {
                    event_target:target_1 = {
                        has_country_flag = player_spam_long_break
                    }
                    event_target:target_1 = {
                        has_policy_flag = medium_anti_propaganda_funding
                    }
                    event_target:target_1 = {
                        has_policy_flag = high_anti_propaganda_funding
                    }
                }
            }
            modifier = { #LIKE THEM MED
                factor = -2.00
                OR = {
                    is_protective_to = event_target:target_1
                    is_loyal_to = event_target:target_1
                    opinion = { who = event_target:target_1 value >= 50 }
                    event_target:target_1 = {
                        has_country_flag = player_spam_break
                    }
                }
            }
            modifier = { #LIKE THEM HIGH
                factor = -3.00
                OR = {
                    is_friendly_to = event_target:target_1
                    opinion = { who = event_target:target_1 value >= 100 }
                }
            }
        }
        event_target:target_1 = {
            save_event_target_as = tech_firstsabotagetarget
        }
        country_event = { id = quibble_spy_ai_tech.2 }
    }
    option = {
        name = quibble_spy_ai_tech.1.b
        trigger = { exists = event_target:target_2 }
        allow = { exists = event_target:target_2 }
        
        ai_chance = {
            factor = 100
            modifier = { #DISLIKE THEM MED
                factor = 2.00
                OR = {
                    tech_unlocked_ratio = {
                        who = event_target:target_2
                        ratio < 0.7
                    }
                    is_unfriendly_to = event_target:target_2
                    is_disloyal_to = event_target:target_2
                    opinion = { who = event_target:target_2 value <= -50 }
                }
            }
            modifier = { #DISLIKE THEM HIGH
                factor = 3.00
                OR = {
                    tech_unlocked_ratio = {
                        who = event_target:target_2
                        ratio < 0.5
                    }
                    is_hostile_to = event_target:target_2
                    is_angry_to = event_target:target_2
                    is_rival = event_target:target_2
                    opinion = { who = event_target:target_2 value <= -100 }
                }
            }
        
            modifier = { #ANTI INTELLIGENCE SCARED OFF
                factor = -0.50
                OR = {
                    event_target:target_2 = {
                        has_country_flag = player_spam_long_break
                    }
                    event_target:target_2 = {
                        has_policy_flag = medium_anti_propaganda_funding
                    }
                    event_target:target_2 = {
                        has_policy_flag = high_anti_propaganda_funding
                    }
                }
            }
            modifier = { #LIKE THEM MED
                factor = -2.00
                OR = {
                    is_protective_to = event_target:target_2
                    is_loyal_to = event_target:target_2
                    opinion = { who = event_target:target_2 value >= 50 }
                    event_target:target_2 = {
                        has_country_flag = player_spam_break
                    }
                }
            }
            modifier = { #LIKE THEM HIGH
                factor = -3.00
                OR = {
                    is_friendly_to = event_target:target_2
                    opinion = { who = event_target:target_2 value >= 100 }
                }
            }
        }
        event_target:target_2 = {
            save_event_target_as = tech_firstsabotagetarget
        }
        country_event = { id = quibble_spy_ai_tech.2 }
    }
    option = {
        name = quibble_spy_ai_tech.1.c
        trigger = { exists = event_target:target_3 }
        allow = { exists = event_target:target_3 }
        
        ai_chance = {
            factor = 100
            modifier = { #DISLIKE THEM MED
                factor = 2.00
                OR = {
                    tech_unlocked_ratio = {
                        who = event_target:target_3
                        ratio < 0.7
                    }
                    is_unfriendly_to = event_target:target_3
                    is_disloyal_to = event_target:target_3
                    opinion = { who = event_target:target_3 value <= -50 }
                }
            }
            modifier = { #DISLIKE THEM HIGH
                factor = 3.00
                OR = {
                    tech_unlocked_ratio = {
                        who = event_target:target_3
                        ratio < 0.5
                    }
                    is_hostile_to = event_target:target_3
                    is_angry_to = event_target:target_3
                    is_rival = event_target:target_3
                    opinion = { who = event_target:target_3 value <= -100 }
                }
            }
        
            modifier = { #ANTI INTELLIGENCE SCARED OFF
                factor = -0.50
                OR = {
                    event_target:target_3 = {
                        has_country_flag = player_spam_long_break
                    }
                    event_target:target_3 = {
                        has_policy_flag = medium_anti_propaganda_funding
                    }
                    event_target:target_3 = {
                        has_policy_flag = high_anti_propaganda_funding
                    }
                }
            }
            modifier = { #LIKE THEM MED
                factor = -2.00
                OR = {
                    is_protective_to = event_target:target_3
                    is_loyal_to = event_target:target_3
                    opinion = { who = event_target:target_3 value >= 50 }
                    event_target:target_3 = {
                        has_country_flag = player_spam_break
                    }
                }
            }
            modifier = { #LIKE THEM HIGH
                factor = -3.00
                OR = {
                    is_friendly_to = event_target:target_3
                    opinion = { who = event_target:target_3 value >= 100 }
                }
            }
        }
        event_target:target_3 = {
            save_event_target_as = tech_firstsabotagetarget
        }
        country_event = { id = quibble_spy_ai_tech.2 }
    }
    option = {
        name = quibble_spy_ai_tech.1.d
        trigger = { exists = event_target:target_4 }
        allow = { exists = event_target:target_4 }
        
        ai_chance = {
            factor = 100
            modifier = { #DISLIKE THEM MED
                factor = 2.00
                OR = {
                    tech_unlocked_ratio = {
                        who = event_target:target_4
                        ratio < 0.7
                    }
                    is_unfriendly_to = event_target:target_4
                    is_disloyal_to = event_target:target_4
                    opinion = { who = event_target:target_4 value <= -50 }
                }
            }
            modifier = { #DISLIKE THEM HIGH
                factor = 3.00
                OR = {
                    tech_unlocked_ratio = {
                        who = event_target:target_4
                        ratio < 0.5
                    }
                    is_hostile_to = event_target:target_4
                    is_angry_to = event_target:target_4
                    is_rival = event_target:target_4
                    opinion = { who = event_target:target_4 value <= -100 }
                }
            }
        
            modifier = { #ANTI INTELLIGENCE SCARED OFF
                factor = -0.50
                OR = {
                    event_target:target_4 = {
                        has_country_flag = player_spam_long_break
                    }
                    event_target:target_4 = {
                        has_policy_flag = medium_anti_propaganda_funding
                    }
                    event_target:target_4 = {
                        has_policy_flag = high_anti_propaganda_funding
                    }
                }
            }
            modifier = { #LIKE THEM MED
                factor = -2.00
                OR = {
                    is_protective_to = event_target:target_4
                    is_loyal_to = event_target:target_4
                    opinion = { who = event_target:target_4 value >= 50 }
                    event_target:target_4 = {
                        has_country_flag = player_spam_break
                    }
                }
            }
            modifier = { #LIKE THEM HIGH
                factor = -3.00
                OR = {
                    is_friendly_to = event_target:target_4
                    opinion = { who = event_target:target_4 value >= 100 }
                }
            }
        }
        event_target:target_4 = {
            save_event_target_as = tech_firstsabotagetarget
        }
        country_event = { id = quibble_spy_ai_tech.2 }
    }
    option = {
        name = quibble_spy_ai_tech.1.e
        trigger = { exists = event_target:target_5 }
        allow = { exists = event_target:target_5 }
        
        ai_chance = {
            factor = 100
            modifier = { #DISLIKE THEM MED
                factor = 2.00
                OR = {
                    tech_unlocked_ratio = {
                        who = event_target:target_5
                        ratio < 0.7
                    }
                    is_unfriendly_to = event_target:target_5
                    is_disloyal_to = event_target:target_5
                    opinion = { who = event_target:target_5 value <= -50 }
                }
            }
            modifier = { #DISLIKE THEM HIGH
                factor = 3.00
                OR = {
                    tech_unlocked_ratio = {
                        who = event_target:target_5
                        ratio < 0.5
                    }
                    is_hostile_to = event_target:target_5
                    is_angry_to = event_target:target_5
                    is_rival = event_target:target_5
                    opinion = { who = event_target:target_5 value <= -100 }
                }
            }
        
            modifier = { #ANTI INTELLIGENCE SCARED OFF
                factor = -0.50
                OR = {
                    event_target:target_5 = {
                        has_country_flag = player_spam_long_break
                    }
                    event_target:target_5 = {
                        has_policy_flag = medium_anti_propaganda_funding
                    }
                    event_target:target_5 = {
                        has_policy_flag = high_anti_propaganda_funding
                    }
                }
            }
            modifier = { #LIKE THEM MED
                factor = -2.00
                OR = {
                    is_protective_to = event_target:target_5
                    is_loyal_to = event_target:target_5
                    opinion = { who = event_target:target_5 value >= 50 }
                    event_target:target_5 = {
                        has_country_flag = player_spam_break
                    }
                }
            }
            modifier = { #LIKE THEM HIGH
                factor = -3.00
                OR = {
                    is_friendly_to = event_target:target_5
                    opinion = { who = event_target:target_5 value >= 100 }
                }
            }
        }
        event_target:target_5 = {
            save_event_target_as = tech_firstsabotagetarget
        }
        country_event = { id = quibble_spy_ai_tech.2 }
    }
    option = {
        name = quibble_spy_ai_tech.1.f
        trigger = { exists = event_target:target_6 }
        allow = { exists = event_target:target_6 }
        
        ai_chance = {
            factor = 100
            modifier = { #DISLIKE THEM MED
                factor = 2.00
                OR = {
                    tech_unlocked_ratio = {
                        who = event_target:target_6
                        ratio < 0.7
                    }
                    is_unfriendly_to = event_target:target_6
                    is_disloyal_to = event_target:target_6
                    opinion = { who = event_target:target_6 value <= -50 }
                }
            }
            modifier = { #DISLIKE THEM HIGH
                factor = 3.00
                OR = {
                    tech_unlocked_ratio = {
                        who = event_target:target_6
                        ratio < 0.5
                    }
                    is_hostile_to = event_target:target_6
                    is_angry_to = event_target:target_6
                    is_rival = event_target:target_6
                    opinion = { who = event_target:target_6 value <= -100 }
                }
            }
        
            modifier = { #ANTI INTELLIGENCE SCARED OFF
                factor = -0.50
                OR = {
                    event_target:target_6 = {
                        has_country_flag = player_spam_long_break
                    }
                    event_target:target_6 = {
                        has_policy_flag = medium_anti_propaganda_funding
                    }
                    event_target:target_6 = {
                        has_policy_flag = high_anti_propaganda_funding
                    }
                }
            }
            modifier = { #LIKE THEM MED
                factor = -2.00
                OR = {
                    is_protective_to = event_target:target_6
                    is_loyal_to = event_target:target_6
                    opinion = { who = event_target:target_6 value >= 50 }
                    event_target:target_6 = {
                        has_country_flag = player_spam_break
                    }
                }
            }
            modifier = { #LIKE THEM HIGH
                factor = -3.00
                OR = {
                    is_friendly_to = event_target:target_6
                    opinion = { who = event_target:target_6 value >= 100 }
                }
            }
        }
        event_target:target_6 = {
            save_event_target_as = tech_firstsabotagetarget
        }
        country_event = { id = quibble_spy_ai_tech.2 }
    }
    option = {
		name = quibble_spy_sab.1.i
		ai_chance = {
			factor = 40
        }
    }
    option = {
        name = quibble_spy_sab.1.g
        allow = { 
            NOR = {
                exists = event_target:target_8
                exists = event_target:target_7
                exists = event_target:target_6
                exists = event_target:target_5
                exists = event_target:target_4
                exists = event_target:target_3
                exists = event_target:target_2
                exists = event_target:target_1
            }
        }
        ai_chance = {
            factor = 1
        }
        country_event = { id = quibble_spy_sab.1 }
    }
}

country_event = { #CHOOSE FUNDING
    id = quibble_spy_ai_tech.2
    is_triggered_only = yes

	option = {
        name = quibble_spy.3.a
        ai_chance = {
			factor = 100
		}
		hidden_effect = {
			random_list = {
				100 = {
                    random_list = {
                        30 = {
                            country_event = { id = quibble_spy_ai_tech.3 days = 60 random = 30 }

                            if = {
                                limit = {
                                    event_target:tech_firstsabotagetarget = {
                                        is_ai = no	
                                    }
                                }
                                event_target:tech_firstsabotagetarget = {
                                    set_timed_country_flag = { flag = player_spam_break days = 730 }
                                    set_timed_country_flag = { flag = player_spam_long_break days = 1460 }
                                }
                            }
                        }
					}
                }
                2 = { #lose
                    modifier = { 
                        add = 100
                        OR = {
                            event_target:tech_firstsabotagetarget = { 
                                has_policy_flag = low_anti_propaganda_funding
                            }

                        }
                    }
                    modifier = { 
                        add = 1000
                        OR = {
                            event_target:tech_firstsabotagetarget = { 
                                has_policy_flag = low_med_anti_propaganda_funding
                            }

                        }
					}
					modifier = { 
                        add = 100000
                        OR = {
                            event_target:tech_firstsabotagetarget = { 
                                has_policy_flag = medium_anti_propaganda_funding
                            }
 
                        }
					}
					modifier = { 
                        add = 10000000
                        OR = {
                            event_target:tech_firstsabotagetarget = { 
                                has_policy_flag = high_anti_propaganda_funding
                            }

                        }
                    }
                    modifier = { 
                        factor = 1.50
                        event_target:tech_firstsabotagetarget = { 
                            is_ai = no
                        }
                    }
					country_event = { id = quibble_spy_ai_tech.4 days = 60 random = 30 }
				}
			}
		}
    }
    option = {
        name = quibble_spy.3.d
        ai_chance = {
			factor = 100
		}
		allow = { 
			
			resource_stockpile_compare = { resource = influence value >= 50 }
		}
		add_resource = { influence = -50 }
		hidden_effect = {
			random_list = {
				10000 = {
                    random_list = {
                        30 = {
                            country_event = { id = quibble_spy_ai_tech.3 days = 60 random = 30 }
                            if = {
                                limit = {
                                    event_target:tech_firstsabotagetarget = {
                                        is_ai = no	
                                    }
                                }
                                event_target:tech_firstsabotagetarget = {
                                    set_timed_country_flag = { flag = player_spam_break days = 730 }
                                    set_timed_country_flag = { flag = player_spam_long_break days = 1460 }
                                }
                            }
                        }
					}
                }
                2 = { #lose
                    modifier = { 
                        add = 100
                        OR = {
                            event_target:tech_firstsabotagetarget = { 
                                has_policy_flag = low_anti_propaganda_funding
                            }

                        }
                    }
                    modifier = { 
                        add = 1000
                        OR = {
                            event_target:tech_firstsabotagetarget = { 
                                has_policy_flag = low_med_anti_propaganda_funding
                            }

                        }
					}
					modifier = { 
                        add = 100000
                        OR = {
                            event_target:tech_firstsabotagetarget = { 
                                has_policy_flag = medium_anti_propaganda_funding
                            }
 
                        }
					}
					modifier = { 
                        add = 10000000
                        OR = {
                            event_target:tech_firstsabotagetarget = { 
                                has_policy_flag = high_anti_propaganda_funding
                            }

                        }
                    }
                    modifier = { 
                        factor = 1.50
                        event_target:tech_firstsabotagetarget = { 
                            is_ai = no
                        }
                    }
					country_event = { id = quibble_spy_ai_tech.4 days = 60 random = 30 }
				}
			}
		}
	}
	option = {
        name = quibble_spy.3.b
        ai_chance = {
			factor = 100
		}
		allow = { 
			
			resource_stockpile_compare = { resource = influence value >= 100 }
		}
		add_resource = { influence = -100 }
		hidden_effect = {
			random_list = {
				1000000 = { # WIN
                    random_list = {
                        30 = {
                            country_event = { id = quibble_spy_ai_tech.3 days = 60 random = 30 }
                            if = {
                                limit = {
                                    event_target:tech_firstsabotagetarget = {
                                        is_ai = no	
                                    }
                                }
                                event_target:tech_firstsabotagetarget = {
                                    set_timed_country_flag = { flag = player_spam_break days = 730 }
                                    set_timed_country_flag = { flag = player_spam_long_break days = 1460 }
                                }
                            }
                        }
					}
                }
                2 = { #lose
                    modifier = { 
                        add = 100
                        OR = {
                            event_target:tech_firstsabotagetarget = { 
                                has_policy_flag = low_anti_propaganda_funding
                            }

                        }
                    }
                    modifier = { 
                        add = 1000
                        OR = {
                            event_target:tech_firstsabotagetarget = { 
                                has_policy_flag = low_med_anti_propaganda_funding
                            }

                        }
					}
					modifier = { 
                        add = 100000
                        OR = {
                            event_target:tech_firstsabotagetarget = { 
                                has_policy_flag = medium_anti_propaganda_funding
                            }
 
                        }
					}
					modifier = { 
                        add = 10000000
                        OR = {
                            event_target:tech_firstsabotagetarget = { 
                                has_policy_flag = high_anti_propaganda_funding
                            }

                        }
                    }
                    modifier = { 
                        factor = 1.50
                        event_target:tech_firstsabotagetarget = { 
                            is_ai = no
                        }
                    }
					country_event = { id = quibble_spy_ai_tech.4 days = 60 random = 30 }
				}
			}
		}
	}
	option = {
        name = quibble_spy.3.c
        ai_chance = {
			factor = 100
		}
		allow = { 
			
			resource_stockpile_compare = { resource = influence value >= 150 }
		}
		add_resource = { influence = -150 }
		hidden_effect = {
			random_list = {
				100000000 = { # WIN
                    random_list = {
                        30 = {
                            country_event = { id = quibble_spy_ai_tech.3 days = 60 random = 30 }
                            if = {
                                limit = {
                                    event_target:tech_firstsabotagetarget = {
                                        is_ai = no	
                                    }
                                }
                                event_target:tech_firstsabotagetarget = {
                                    set_timed_country_flag = { flag = player_spam_break days = 730 }
                                    set_timed_country_flag = { flag = player_spam_long_break days = 1460 }
                                }
                            }
                        }
					}
                }
                2 = { #lose
					modifier = { 
                        add = 100
                        OR = {
                            event_target:tech_firstsabotagetarget = { 
                                has_policy_flag = low_anti_propaganda_funding
                            }

                        }
                    }
                    modifier = { 
                        add = 1000
                        OR = {
                            event_target:tech_firstsabotagetarget = { 
                                has_policy_flag = low_med_anti_propaganda_funding
                            }

                        }
					}
					modifier = { 
                        add = 100000
                        OR = {
                            event_target:tech_firstsabotagetarget = { 
                                has_policy_flag = medium_anti_propaganda_funding
                            }
 
                        }
					}
					modifier = { 
                        add = 10000000
                        OR = {
                            event_target:tech_firstsabotagetarget = { 
                                has_policy_flag = high_anti_propaganda_funding
                            }

                        }
                    }
                    modifier = { 
                        factor = 1.50
                        event_target:tech_firstsabotagetarget = { 
                            is_ai = no
                        }
                    }
					country_event = { id = quibble_spy_ai_tech.4 days = 60 random = 30 }
				}
			}
		}
	}
}

country_event = {  #
    id = quibble_spy_ai_tech.3
    title = "quibble_spy_ai_tech.3.name"
    desc = "quibble_spy_ai_tech.3.desc"
    is_triggered_only = yes
    hide_window = yes
    
    immediate = { # randsom agent
        random_list = {
            10 = {
                random_list = {
                    10 = {
                        add_monthly_resource_mult = {
                            resource = engineering_research
                            value = @tier2researchreward
                            min = @tier2researchmin
                            max = @tier2researchmax
                        }
                    }
                    10 = {
                        add_monthly_resource_mult = {
                            resource = society_research
                            value = @tier2researchreward
                            min = @tier2researchmin
                            max = @tier2researchmax
                        }
                    }
                    10 = {
                        add_monthly_resource_mult = {
                            resource = physics_research
                            value = @tier2researchreward
                            min = @tier2researchmin
                            max = @tier2researchmax
                        }
                    }
                }
            }
            10 = {
                random_list = {
                    10 = {
                        country_event = { id = quibble_spy_tech_eng.1 }
                    }
                    10 = {
                        country_event = { id = quibble_spy_tech_phys.1 }
                    }
                    10 = {
                        country_event = { id = quibble_spy_tech_soc.1 }
                    }
                }
            }
        }
    }
}

country_event = {  #CHECK IF PLAYER
    id = quibble_spy_ai_tech.4
    is_triggered_only = yes
    hide_window = yes
    
    immediate = {
        IF = {
            limit = {
                event_target:tech_firstsabotagetarget = {
                    is_ai = no
                }
            }
            random_list = {
                10 = {
                }
                5 = {
                    event_target:tech_firstsabotagetarget = {
                        country_event = { id = quibble_spy_ai_tech.4 }
                        set_timed_country_flag = { flag = player_spam_break days = 730 }
                        set_timed_country_flag = { flag = player_spam_long_break days = 1460 }
                    }
                    
                }
            }   
        }
    }
}

country_event = {  #TECH STEAL PLAYER catches agent
    id = quibble_spy_ai_tech.4
    title = "quibble_spy_ai_tech.2.name"
    desc = "quibble_spy_ai_tech.2.desc"
    is_triggered_only = yes

    custom_gui = quibble_spy_window
    diplomatic = yes

	picture_event_data = {
		portrait = event_target:quibble_leader
		room = quibble_11_room
    }
    
    option = { # randsom agent
		name = quibble_spy_ai_tech.2.a
        custom_gui = quibble_spy_option
    }
}